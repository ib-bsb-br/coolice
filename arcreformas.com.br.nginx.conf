# /arcreformas.com.br.nginx.conf

# Rule to redirect API requests to the front controller.
location /api/ {
  # If the requested file or directory doesn't exist, pass the request to the PHP script.
  try_files $uri $uri/ /api/index.php?$query_string;
}

# Generic PHP handler for all .php files.
location ~ \.php$ {
  # Ensure the script exists before passing to FastCGI.
  try_files $uri =404;

  # Include standard FastCGI parameters.
  include fastcgi_params;

  # Set the SCRIPT_FILENAME to the absolute path of the requested file.
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

  # Pass the request to the PHP-FPM socket.
  # Note: The actual socket path may vary (e.g., /var/run/php/php7.4-fpm.sock).
  fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
}
