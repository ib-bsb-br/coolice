# WARNING: These customizations are applied on top of the DirectAdmin default
# Nginx configuration. If the provider's global templates already define
# equivalent blocks (e.g., for PHP handling), these rules may be redundant
# or cause conflicts. Please review the final compiled Nginx configuration.

# Security Hardening: Deny access to hidden files.
location ~ /\.(?!well-known).* {
    deny all;
}

# Rule to redirect API requests to the front controller using a named location.
location /api/ {
    try_files $uri $uri/ @api_rewrite;
}

location @api_rewrite {
    rewrite ^/api/(.*)$ /api/index.php?q=$1&$args last;
}

# Generic PHP handler for all .php files.
# This block is based on the standard DirectAdmin template to ensure
# compatibility with the hosting environment (PHP-FPM via Unix socket).
location ~ \.php$ {
    try_files $uri =404;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    include /etc/nginx/fastcgi_params;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include /etc/nginx/nginx_limits.conf;

    # Using Unix socket as per DirectAdmin documentation.
    # The PHP version '83' is inferred from a comment in the original file.
    fastcgi_pass unix:/usr/local/php83/sockets/webapps.sock;
}
