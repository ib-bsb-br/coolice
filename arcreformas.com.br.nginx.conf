# /arcreformas.com.br.nginx.conf

# Rule to redirect API requests to the front controller using a named location.
location /api/ {
    try_files $uri $uri/ @api_rewrite;
}

location @api_rewrite {
    rewrite ^/api/(.*)$ /api/index.php?q=$1&$args last;
}

# Generic PHP handler for all .php files.
location ~ \.php$ {
  # Ensure the script exists before passing to FastCGI.
  try_files $uri =404;

  # Include standard FastCGI parameters.
  include fastcgi_params;

  # Set the SCRIPT_FILENAME to the absolute path of the requested file.
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

  # Pass the request to the PHP-FPM socket.
  #
  # !!! IMPORTANT !!!
  # The socket path below is a common default but may NOT match your server's configuration.
  # You MUST verify this path. If it's incorrect, your PHP pages will not load.
  #
  # Common socket paths depend on your OS and PHP version:
  # - /var/run/php/php7.4-fpm.sock  (Ubuntu/Debian with PHP 7.4)
  # - /var/run/php/php8.1-fpm.sock  (Ubuntu/Debian with PHP 8.1)
  # - /var/run/php-fpm/www.sock     (CentOS/RHEL)
  # - /tmp/php-fpm.sock
  #
  # Check your /etc/php-fpm.d/www.conf (or similar) file for the correct 'listen' directive.
  #
  # OPTIONAL: For easier management, you can define a variable in your main Nginx config
  # (e.g., in the http or server block) and use it here:
  #
  # In main config: set $php_fpm_socket unix:/path/to/your/socket.sock;
  # Then use here:  fastcgi_pass $php_fpm_socket;
  #
  fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
}
