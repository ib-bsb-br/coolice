# /arcreformas.com.br.nginx.conf

# Rule to redirect API requests to the front controller using a named location.
location /api/ {
    try_files $uri $uri/ @api_rewrite;
}

location @api_rewrite {
    rewrite ^/api/(.*)$ /api/index.php?q=$1&$args last;
}

# Generic PHP handler for all .php files.
location ~ \.php$ {
  # Ensure the script exists before passing to FastCGI.
  try_files $uri =404;

  # Include standard FastCGI parameters.
  include fastcgi_params;

  # Set the SCRIPT_FILENAME to the absolute path of the requested file.
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

  # Pass the request to the PHP-FPM process.
  # Based on the server's default configuration found at
  # /usr/local/php83/etc/php-fpm.d/www.conf.default,
  # PHP-FPM is listening on a TCP socket, not a Unix socket.
  fastcgi_pass 127.0.0.1:9000;
}