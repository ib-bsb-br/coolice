# /arcreformas.com.br.nginx.conf

# Rule to redirect API requests to the front controller.
location /api/ {
  # Rewrite all API requests to the front controller, passing the path as the 'q' parameter.
  rewrite ^/api/(.*)$ /api/index.php?q=$1&$args last;
}

# Generic PHP handler for all .php files.
location ~ \.php$ {
  # Ensure the script exists before passing to FastCGI.
  try_files $uri =404;

  # Include standard FastCGI parameters.
  include fastcgi_params;

  # Set the SCRIPT_FILENAME to the absolute path of the requested file.
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

  # Pass the request to the PHP-FPM socket.
  # NOTE: The actual socket path may vary by system (e.g., /var/run/php/php7.4-fpm.sock, /run/php/php8.1-fpm.sock).
  # To make this portable, set the PHP_FPM_SOCKET variable in your environment or in an included config file.
  # Example: set $PHP_FPM_SOCKET /var/run/php/php7.4-fpm.sock;
  # If not set, fallback to a default path.
  set $PHP_FPM_SOCKET /var/run/php-fpm/php-fpm.sock;
  fastcgi_pass unix:$PHP_FPM_SOCKET;
}
