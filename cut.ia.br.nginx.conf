# WARNING: These customizations are applied on top of the DirectAdmin default
# Nginx configuration. If the provider's global templates already define
# equivalent blocks (e.g., for PHP handling), these rules may be redundant
# or cause conflicts. Please review the final compiled Nginx configuration.

# Security Hardening: Deny access to hidden files.
location ~ /\.(?!well-known).* {
    deny all;
}

# Default server behavior
location / {
    # Try to serve a file directly, then a directory, then fall back to index.php
    try_files $uri $uri/ /index.php?$args;
}

# Generic PHP handler for all .php files.
# This block is based on the standard DirectAdmin template to ensure
# compatibility with the hosting environment (PHP-FPM via Unix socket).
location ~ \.php$ {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    try_files $fastcgi_script_name =404;
    include /etc/nginx/fastcgi_params;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include /etc/nginx/nginx_limits.conf;

    # Using Unix socket as per DirectAdmin documentation.
    # Assuming PHP version '83' for consistency.
    fastcgi_pass unix:/usr/local/php83/sockets/webapps.sock;
}
